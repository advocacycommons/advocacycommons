require 'google/apis/admin_directory_v1'
require 'google/apis/groupssettings_v1'

class GoogleAPI::CreateGoogleGroup
  class << self
    def call(authorization:, group_email:, group_name:)
      directory_service = build_directory_service(authorization)

      create_google_group(directory_service, group_email, group_name)
    end

    private

    def build_directory_service(authorization)
      GoogleAPI::BuildDirectoryService.call(authorization: authorization)
    end

    def create_google_group(directory_service, group_email, group_name)
      slugified_group_name = group_name.downcase.split.join('-')

      group = Google::Apis::AdminDirectoryV1::Group.new(
        email: group_email,
        name: group_name,
        description: "This is a Google Group generated by Affinity.works."
      )

      directory_service.insert_group(group)
    end
  end
end
<html>
	<!-- -->
	<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- CSS -->
        <link rel="stylesheet" type="text/css" href="/indivisibleform/style/header.css" />

	    	<link rel="stylesheet" type="text/css" href="/indivisibleform/style/body.css" />
        <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <!-- link href="http://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css" rel="stylesheet" type="text/css"  -->
				<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <link href="/indivisibleform/style/whitelabel.css" rel="stylesheet" type="text/css">
			  <link rel="stylesheet" type="text/css" href="/indivisibleform/style/form.css" />
        <link rel="stylesheet" type="text/css" href="/indivisibleform/style/parsley.css" />

        <!-- end CSS -->

        <!-- JS -->

        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script
		  		src="https://code.jquery.com/jquery-3.1.1.min.js"
			  	integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
				crossorigin="anonymous">
		</script>
		<script src="/indivisibleform/js/parsley.js" type="text/javascript"></script>
		<script src="/indivisibleform/js/jquery.osdi.js" type="text/javascript"></script>
		<script src="/indivisibleform/js/formfixer.js" type="text/javascript"></script>

		<!-- script type="text/javascript">
				$(document).ready(function() {
				$('testform').osdi();
				});
		</script  -->

				<!-- end JS -->

    </head>
  <body>
	<div id="form-container">
            <!-- script src="https://actionnetwork.org/widgets/v2/form/indivisible-group-signup?format=js&amp;source=widget&amp;style=full&amp;clear_id=true"></script -->
    <div id="can-form-area-indivisible-group-signup" style="width: 500px">
			<div id="success"></div>
      <div class="can_embed v2  form form_full full">
	    	<div id="can_embed_form">
          <div id="can_main_col">
            <div class="control-title">Indivisible</div>
						<div class="control-subtitle">Group Registration</div>
          </div>
          <div id="can_sidebar">
            <form id="new_answer" data-parsley-validate="" action="/" class="new_answer"  method="post" accept-charset="UTF-8" >
							<div class="control-group">
								<label class="control-label" for="GroupName"></label>
								<input
									id="GroupName"
									name="GroupName"
									placeholder="Group Name *"
									data-parsley-trigger="change"
									data-parsley-minlength="2"
									data-parsley-group="group-name"
									data-parsley-required
									type="text">
							</div>
							<div class="mission">
							  <label class="control-label check_radio_label">Your group may be pursuing the Indivisible strategy as your main goal or as part of a broader mission. Whatever works! This is for anyone who agrees with these three principles (required):</label>
							  <span class="controls check_radio_field">
										<ol class="principles-ordered-list">
											<li class="principle">Resist Trump's agenda. We believe Trumpâ€™s agenda is racist, authoritarian, and corrupt, and it must be stopped.</li>
											<li class="principle">Focus on local, defensive congressional advocacy. We demand that our own local Members of Congress serve as our voice in Washington, DC.</li>
											<li class="principle">Embrace progressive values. We model inclusion, respect, and fairness in all of our actions.</li>
										</ol>
										<div class="principles-error-message"></div>
										<label class="checkbox">
											I agree.
								    	<input type="checkbox" name="PrinciplesAgreeV1" data-parsley-group="PrinciplesAgreeV1" data-parsley-required value="1" class=" required=""  checkbox_group">
							    </label>
							  </span>
							</div>
							<div class="group-info-error-message"></div>
							 <label class="control-label group-contact-info-label">How should people contact your group? Please list at least one form of contact info below (note: this will be listed in the public directory).</label>
              <div class="control-group">
                <label class="control-label" for="GroupEmail"></label>
                <input
									id="GroupEmail"
									name="GroupEmail"
									placeholder="Group email address"
									type="email"
									data-parsley-group="group-email">
              </div>
              <div class="control-group">
                <label class="control-label" for="GroupFBpage"></label>
                <input id="GroupFBpage"
									name="GroupFBpage"
									placeholder="Link to Facebook page"
									type="text"
									data-parsley-type="url"
									data-parsley-group="group-fb">
              </div>
              <div class="control-group">
                <label class="control-label" for="GroupTwitter"></label>
                <input id="GroupTwitter"
									name="GroupTwitter"
									placeholder="Link to Twitter page"
									type="text"
									data-parsley-type="url"
									data-parsley-group="group-twitter">
              </div>
              <div class="control-group">
                <label class="control-label" for="GroupWebsite"></label>
                <input
									id="GroupWebsite"
									name="GroupWebsite"
									placeholder="Website link"
									type="text"
									data-parsley-type="url"
									data-parsley-group="group-web">
              </div>
              <div class="control-group">
                <label class="control-label" for="GroupPhoneNumber"></label>
                <input
									id="GroupPhoneNumber"
									name="GroupPhoneNumber"
									placeholder="Group phone number"
									type="text" >
              </div>
							<div class="control-group">
                <label class="control-label" for="GroupCity"></label>
                <input
									id="GroupCity"
									name="GroupCity"
									placeholder="Group city *"
									data-parsley-required
									type="text" >
              </div>
							<div class="control-group">
                <label class="control-label" for="GroupState"></label>
                <input
									id="GroupState"
									name="GroupState"
									placeholder="Group state *"
									data-parsley-required
									data-parsley-type="alphanum"
									type="text" >
              </div>
							<div class="control-group">
                <label class="control-label" for="GroupZip"></label>
                <input
									id="GroupZip"
									name="GroupZip"
									placeholder="Group zip *"
									data-parsley-required
									data-parsley-type="digits"
									data-parsley-minlength="5"
									data-parsley-maxlength="5"
									type="text" >
              </div>
							<div class="part-two-head step-two">And now please tell us about you...</div>
							<div class="control-group step-two">
								<input
										id="first"
										name="first"
										placeholder="Your first name"
										size="35"
										background-repeat: no-repeat;
										background-attachment: scroll;
										background-size: 16px 18px;
										background-position: 98% 50%;
										type="text">
							</div>
							<div class="control-group step-two">
								<input id="last"
									name="last"
									placeholder="Your last name"
									size="35"
									type="text">
							</div>
							<div class="control-group step-two">
								<input
									id="email"
									name="email"
									placeholder="Your email *"
									size="35" value=""
									type="email"
									data-parsley-trigger="change"
									required="" >
							</div>
							<div class="control-group step-two">
								<input
									id="postal_code"
									name="postal_code"
									placeholder="Your zip/postal code *"
									required=""
									size="35" type="text"
									data-parsley-type="digits"
									data-parsley-minlength="5"
									data-parsley-maxlength="5"
									data-parsley-trigger="change" >
							</div>
							<div class="control-group step-two">
								<input
								  id="cell_phone"
									name="cell_phone"
									placeholder="Your cell phone"
									size="35" type="text"
									data-parsley-type="digits"
									data-parsley-minlength="10"
									data-parsley-maxlength="10"
									data-parsley-trigger="change" >
							</div>
							<div class="step-two">
								<input type="checkbox" id="SMSOptInV1" name="SMSOptInV1" data-parsley-group="SMSOptInV1" value="1" class=" required checkbox_group">
								<label class="checkbox sms-optin-label" for="SMSOptInV1">
									By checking this box, I authorize Indivisible to send text messages about actions and other information that might be of interest to me to this phone number. Standard rates will apply. I understand that I can withdraw this consent at any time by email to data@indivisibleguide.com.
								</label>
							</div>
							<div class="invalid-form-error-message"></div>
							<button class="next-step">Next...</button>
              <input
								name="commit"
								value="Add Your Group"
								type="submit"
								id="group-submit"
								class="btn btn-default validate step-two">
            </form>
          </div>
   		 	</div>
      </div>
	  </div>
	</div>

	<script type="text/javascript">

	$(function () {
		$('.next-step').on('click', function() {
				var formInstance = $('#new_answer').parsley();
				var principlesOk = false;
				var groupOk = false;
				formInstance.validate({group: 'group-name', force: true});

				if (formInstance.isValid({group: 'PrinciplesAgreeV1', force: true})) {
					$('.principles-error-message').html('').removeClass('filled');
					principlesOk = true;
				} else {
					$('.principles-error-message')
						.html('Please check to show you agree with the Indivisible principles.')
						.addClass('filled');
						formInstance.validationResult = false;
				}

				if (
					formInstance.isValid({group: 'group-email', force: true}) ||
					formInstance.isValid({group: 'group-fb', force: true}) ||
					formInstance.isValid({group: 'group-web', force: true}) ||
					formInstance.isValid({group: 'group-twitter', force: true})
				) {
					$('.group-info-error-message').html('').removeClass('filled');
					groupOk = true;
				} else {
					$('.group-info-error-message')
						.html('Please enter at least one: your group email, Facebook page, or Twitter url.')
						.toggleClass('filled', !groupOk);
						formInstance.validationResult = false;
				}

				if (groupOk && principlesOk) {
					$('.step-two').show();
					$('.next-step').hide();
					$('.invalid-form-error-message').html('').removeClass('filled');
					return false;
				} else {
					$('.invalid-form-error-message')
						.html('Please check your form for problems, above.')
						.addClass('filled');
					formInstance.validationResult = false;
					return false;
				}
		});

	  $('#new_answer').parsley().on('form:validate', function (formInstance) {
			var ok = $('.parsley-error').length === 0;
			$('.bs-callout-info').toggleClass('hidden', !ok);
			$('.bs-callout-warning').toggleClass('hidden', ok);
	  })
		.on('form:submit', function(e) {
			$('#new_answer').osdi({
				endpoint: "https://actionnetwork.org/api/v2/forms/e2d2df13-7d5f-42f0-a80b-6f7d4c7b32b4/submissions",
				body: function() {
					return {
						"person": {
							"given_name": $('#first').val(),
							"family_name": $('#last').val(),
							'postal_addresses' : [
								{ 'postal_code': $('#postal_code').val() }
							],
							"email_addresses": [
								{
									"address": $('#email').val()
								}
							],

							"custom_fields": {
								// These are no longer going to match up 1:1 because we're using Indivisible's existing AN custom fields.  Be VERY careful when modifying these.
								"Group Name": $('#GroupName').val(),
								"Group email address": $('#GroupEmail').val(),
								"Group phone number": $('#GroupPhoneNumber').val(),
								"Group facebook link": $('#GroupFBpage').val(),
								"Group twitter handle": $('#GroupTwitter').val(),
								"Group website link": $('#GroupWebsite').val(),
								"GroupCity" : $('#GroupCity').val(),
								"GroupState" : $('#GroupState').val(),
								"GroupZip" : $('#GroupZip').val(),
								"Text Message Permission" : $('#SMSOptInV1').prop('checked'),
								"Mobile Phone Number" : $('#cell_phone').val(),
	  					},
						},
					}
				},
				immediate: true,
				done: function(data, textStatus, jqXHR) {
					window.location.replace("https://www.indivisibleguide.com/");
					 $('#success').html('<p><strong>It worked!</strong></p>');
				},
				fail: function(jqXHR, textStatus, errorThrown) {
					console.log('fail');
					$('#success').html('<p><strong>It failed!</strong></p>');
				},
				always: function(data_jqXHR, textStatus, jqXHR_errorThrown) {
					console.log('always');
					console.log(data_jqXHR);
				}
			});

			return false;
		});
	});
	</script>

</html>
